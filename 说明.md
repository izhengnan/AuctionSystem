# 简单拍卖系统设计（极简版）
## 一、核心设计思路
聚焦「用户注册/登录→管理员增改拍品→用户出价竞拍→成交生成订单→付款完成交易」核心流程，仅保留必要字段和接口，无复杂资金体系、物流流程，适合演示/练手场景。

## 二、表结构设计
### 1. 用户表（t_user）
| 字段名    | 类型         | 主键 | 注释                                  |
|-----------|--------------|------|---------------------------------------|
| id        | bigint       | 是   | 用户ID（自增）                        |
| username  | varchar(50)  | 否   | 用户名（唯一，登录/标识用）           |
| password  | varchar(128) | 否   | 密码（加密存储）                      |
| role      | tinyint      | 否   | 角色：0-管理员，1-普通用户（默认1）   |
| create_time | datetime     | 否   | 创建时间                              |
| update_time | datetime     | 否   | 更新时间                              |

### 2. 拍品表（t_auction_item）
| 字段名              | 类型         | 主键 | 注释                                   |
|---------------------|--------------|------|----------------------------------------|
| id                  | bigint       | 是   | 拍品ID（自增）                         |
| title               | varchar(100) | 否   | 拍品名称                               |
| image               | varchar(255) | 否   | 拍品图片URL（单张）                    |
| initial_price       | decimal(10,2)| 否   | 起拍价（单位：元）                     |
| price_step          | decimal(10,2)| 否   | 加价幅度（每次至少加价金额）           |
| start_time          | datetime     | 否   | 起拍时间                               |
| end_time            | datetime     | 否   | 结束时间                               |
| current_max_price   | decimal(10,2)| 否   | 当前最高价（默认=起拍价）              |
| current_max_user_id | bigint       | 否   | 当前最高出价用户ID（默认null）         |
| status              | tinyint      | 否   | 状态：0-未开始，1-竞拍中，2-已结束     |
| create_time         | datetime     | 否   | 创建时间                               |
| update_time         | datetime     | 否   | 更新时间                               |

### 3. 竞拍记录表（t_auction_record）
| 字段名    | 类型         | 主键 | 注释                          |
|-----------|--------------|------|-------------------------------|
| id        | bigint       | 是   | 记录ID（自增）                |
| item_id   | bigint       | 否   | 关联拍品ID                    |
| user_id   | bigint       | 否   | 出价用户ID                    |
| bid_price | decimal(10,2)| 否   | 出价金额（元）                |
| bid_time  | datetime     | 否   | 出价时间                      |

### 4. 订单表（t_auction_order）
| 字段名      | 类型         | 主键 | 注释                                   |
|-------------|--------------|------|----------------------------------------|
| id          | bigint       | 是   | 订单ID（自增）                         |
| item_id     | bigint       | 否   | 关联拍品ID                             |
| user_id     | bigint       | 否   | 买家ID                                 |
| deal_price  | decimal(10,2)| 否   | 成交价格（=拍品最终最高价）            |
| status      | tinyint      | 否   | 状态：0-待付款，1-已完成，2-流拍       |
| update_time | datetime     | 否   | 更新时间                               |

## 三、接口设计（RESTful风格）
### 1. 通用响应格式
```json
{
  "code": 200,  // 200成功，400参数错误，401未登录/权限不足
  "msg": "操作成功",
  "data": {}
}
```

### 2. 用户模块
| 接口功能 | 请求方式 | 接口路径          | 核心参数               | 备注                                          |
|----------|----------|-------------------|------------------------|-----------------------------------------------|
| 用户注册 | POST     | /api/user/register| username, password     | 密码加密，默认角色为1（普通用户），返回用户ID |
| 用户登录 | POST     | /api/user/login   | username, password     | 返回用户ID+角色+token（JWT含userId和role）    |

### 3. 拍品模块
| 接口功能     | 请求方式 | 接口路径                  | 核心参数                                                                 | 备注                                          |
|--------------|----------|---------------------------|--------------------------------------------------------------------------|-----------------------------------------------|
| 添加拍品     | POST     | /api/item/add             | title, image, initial_price, price_step, start_time, end_time, token     | 需登录+角色为0（管理员），否则返回401权限不足 |
| 修改拍品     | POST     | /api/item/update/{itemId} | title, image, initial_price, price_step, start_time, end_time, token     | 仅管理员+拍品状态为0（未开始）可修改          |
| 拍品列表     | GET      | /api/item/list            | pageNum, pageSize, status, minPrice, maxPrice, keyword                   | 公开，分页查询所有拍品，支持多条件筛选        |
| 拍品详情     | GET      | /api/item/detail/{itemId} | -                                                                        | 公开，含当前最高价/状态                       |
| 查询拍品信息 | GET      | /api/item/{itemId}        | itemId                                                                   | 用于修改拍品时查询回显信息，仅管理员可访问    |
| 批量删除拍品 | POST     | /api/item/batch-delete    | itemIds, token                                                           | 仅管理员可操作                                |

### 4. 竞拍模块
| 接口功能 | 请求方式 | 接口路径      | 核心参数               | 备注                                   |
|----------|----------|---------------|------------------------|----------------------------------------|
| 出价竞拍 | POST     | /api/bid      | itemId, bidPrice, token | 需登录（任意角色）；校验拍品状态+出价规则 |

### 5. 订单模块
| 接口功能       | 请求方式 | 接口路径                  | 核心参数                          | 备注                                   |
|----------------|----------|---------------------------|-----------------------------------|----------------------------------------|
| 生成订单       | POST     | /api/order/create/{itemId}| token                             | 需登录，仅拍品结束且有最高价可生成     |
| 订单付款       | POST     | /api/order/pay/{orderId}  | address, token                    | 需登录，仅改状态为已完成+保存地址      |
| 我的订单列表   | GET      | /api/order/my             | token                             | 查当前用户所有订单                     |

## 四、核心业务保障
### 1. 角色权限校验
- 所有需登录的接口先校验token有效性，解析出userId和role；
- 添加/修改拍品接口额外校验role=0，否则返回权限不足；
- 出价、订单相关接口仅校验登录（role=0/1均可操作）。

### 2. 竞拍并发处理
数据库行锁保障原子性，避免多用户同时出价导致数据异常：
- 出价时先对拍品行加锁，查询当前最高价和加价幅度；
- 校验出价金额≥当前最高价+加价幅度，通过后更新拍品当前最高价和最高出价用户ID。

### 3. 拍品状态自动更新
定时任务（每分钟执行）自动更新拍品状态：
- 未开始→竞拍中：拍品状态为0且当前时间≥起拍时间，更新状态为1；
- 竞拍中→已结束：拍品状态为1且当前时间≥结束时间，更新状态为2；
- 结束后生成订单：有最高出价用户则创建待付款订单，无则创建流拍订单。

## 五、简化版扩展说明
1. 管理员角色：极简版无“修改角色”接口，需手动在数据库修改`role`字段（如将用户role从1改为0）；
2. 用户名唯一：注册时校验用户名不重复，避免重复注册；
3. 密码加密：建议使用BCrypt加密（而非MD5），提升安全性；
4. 后续扩展：可按需添加角色管理接口、多图上传、第三方支付对接、物流流程等功能。
