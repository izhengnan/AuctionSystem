# 简单拍卖系统设计（极简版）
## 一、核心设计思路
聚焦「用户注册/登录→管理员增改拍品→用户出价竞拍→成交生成订单→付款完成交易」核心流程，仅保留必要字段和接口，无复杂资金体系、物流流程，适合演示/练手场景。

## 二、表结构设计
### 1. 用户表（t_user）
| 字段名    | 类型         | 主键 | 注释                                  |
|-----------|--------------|------|---------------------------------------|
| id        | bigint       | 是   | 用户ID（自增）                        |
| username  | varchar(50)  | 否   | 用户名（唯一，登录/标识用）           |
| password  | varchar(128) | 否   | 密码（加密存储）                      |
| role      | tinyint      | 否   | 角色：0-管理员，1-普通用户（默认1）   |
| create_time | datetime     | 否   | 创建时间                              |
| update_time | datetime     | 否   | 更新时间                              |

### 2. 拍品表（t_auction_item）
| 字段名              | 类型         | 主键 | 注释                                   |
|---------------------|--------------|------|----------------------------------------|
| id                  | bigint       | 是   | 拍品ID（自增）                         |
| title               | varchar(100) | 否   | 拍品名称                               |
| image               | varchar(255) | 否   | 拍品图片URL（单张）                    |
| initial_price       | decimal(10,2)| 否   | 起拍价（单位：元）                     |
| description         | varchar(500) | 否   | 拍品描述                               |
| start_time          | datetime     | 否   | 起拍时间                               |
| end_time            | datetime     | 否   | 结束时间                               |
| current_max_price   | decimal(10,2)| 否   | 当前最高价（默认=起拍价）              |
| current_max_user_id | bigint       | 否   | 当前最高出价用户ID（默认null）         |
| status              | tinyint      | 否   | 状态：0-未开始，1-竞拍中，2-已结束     |
| create_time         | datetime     | 否   | 创建时间                               |
| update_time         | datetime     | 否   | 更新时间                               |

### 3. 竞拍记录表（t_auction_record）
| 字段名    | 类型         | 主键 | 注释                          |
|-----------|--------------|------|-------------------------------|
| id        | bigint       | 是   | 记录ID（自增）                |
| item_id   | bigint       | 否   | 关联拍品ID                    |
| user_id   | bigint       | 否   | 出价用户ID                    |
| bid_price | decimal(10,2)| 否   | 出价金额（元）                |
| bid_time  | datetime     | 否   | 出价时间                      |

### 4. 订单表（t_auction_order）
| 字段名      | 类型         | 主键 | 注释                                   |
|-------------|--------------|------|----------------------------------------|
| id          | bigint       | 是   | 订单ID                                 |
| item_id     | bigint       | 否   | 关联拍品ID                             |
| user_id     | bigint       | 否   | 买家ID                                 |
| deal_price  | decimal(10,2)| 否   | 成交价格（=拍品最终最高价）            |
| status      | tinyint      | 否   | 状态：0-待付款，1-已完成                |
| update_time | datetime     | 否   | 更新时间                               |

## 三、接口设计（RESTful风格）
### 1. 通用响应格式
```json
{
  "code":
  "msg":,
  "data": {}
}
```

### 2. 用户模块
| 接口功能 | 请求方式 | 接口路径          | 核心参数               | 备注                                          |
|----------|----------|-------------------|------------------------|-----------------------------------------------|
| 用户注册 | POST     | /user/register| username, password     | 密码加密，默认角色为1（普通用户），返回用户ID |
| 用户登录 | POST     | /user/login   | username, password     | 返回用户ID+token（JWT含userId）    |
| 管理员登录 | POST   | /admin/login  | username, password, role | 管理员专用登录接口，role参数用于区分管理员身份 |

### 3. 通用模块
| 接口功能 | 请求方式 | 接口路径             | 核心参数    | 备注                                          |
|----------|----------|----------------------|-------------|-----------------------------------------------|
| 文件上传 | POST     | /admin/common/upload | file         |用于添加拍品和修改拍品的图片上传功能            |

### 4. 拍品模块
| 接口功能     | 请求方式 | 接口路径                  | 核心参数                                                                 |
|--------------|----------|---------------------------|--------------------------------------------------------------------------|-----------------------------------------------|
| 添加拍品     | PUT      | /item/add             | title, image, initial_price, description, start_time, end_time, token     |
| 修改拍品     | PUT      | /item/update          | title, image, initial_price, description, start_time, end_time, token     | 
| 拍品列表     | GET      | /item/list            | pageNum, pageSize, status, minPrice, maxPrice, keyword                   | 
| 查询拍品信息 | GET      | /item/{itemId}        | itemId                                                                   | 
| 批量删除拍品 | DELETE    | /item/    | itemIds, token                                                                        |

### 5. 竞拍模块
| 接口功能 | 请求方式 | 接口路径      | 核心参数               | 备注                                   |
|----------|----------|---------------|------------------------|----------------------------------------|
| 出价竞拍     | POST     | /bid                  | itemId, bidPrice, token |校验拍品状态+出价规则 |
| 查询竞拍记录 | GET      | /bid/records/{itemId} | itemId                   | 根据拍品ID查询所有竞拍记录，从区块链获取数据 |

### 6. 订单模块
| 接口功能       | 请求方式 | 接口路径                  | 核心参数                          | 备注                                   |
|----------------|----------|---------------------------|-----------------------------------|----------------------------------------|
| 生成订单       |                                                                      | 拍品状态为2时且有最高出价用户时自动生成 ，且每件拍品只生成一次    |
| 订单付款       | POST     | /order/pay/{orderId}  | orderId, address, token           | 修改订单状态为已完成      |
| 我的订单列表   | GET      | /order/my              | token                             | 查当前用户所有订单                     |

## 四、核心业务保障
### 1. 角色权限校验
- 所有需登录的接口先校验token有效性，解析出userId和role；
- 添加/修改拍品接口额外校验role=0，否则返回权限不足；
- 出价、订单相关接口仅校验登录（role=0/1均可操作）。

### 2. 竞拍并发处理
数据库行锁保障原子性，避免多用户同时出价导致数据异常：
- 出价时先对拍品行加锁，查询当前最高价和加价幅度；
- 校验出价金额≥当前最高价+加价幅度，通过后更新拍品当前最高价和最高出价用户ID。

### 3. 拍品状态自动更新
定时任务（每分钟执行）自动更新拍品状态：
- 未开始→竞拍中：拍品状态为0且当前时间≥起拍时间，更新状态为1；
- 竞拍中→已结束：拍品状态为1且当前时间≥结束时间，更新状态为2；
- 结束后生成订单：有最高出价用户则创建待付款订单，无则创建流拍订单。

### 4. 区块链数据上链
- 出价记录实时上链，确保数据不可篡改；
- 订单生成记录上链，保证交易透明可信；

## 五、简化版扩展说明
1. 管理员角色：极简版无"修改角色"接口，需手动在数据库修改`role`字段（如将用户role从1改为0）；
2. 用户名唯一：注册时校验用户名不重复，避免重复注册；
3. 密码加密：建议使用BCrypt加密（而非MD5），提升安全性；
4. 后续扩展：可按需添加角色管理接口、多图上传、第三方支付对接、物流流程等功能。
